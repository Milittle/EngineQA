# 场景 01：填充率掉零（Fill Rate = 0）

- index: ad_opt_scene_01
- id: fill_rate_zero
- tags: 填充率, 请求链路, 配置变更, 紧急止损

## 场景描述
某广告位在 10 分钟内填充率从 42% 下降到 0%，请求量正常，但无有效返回。

## 关键观测
- `request_qps` 基本稳定，`response_qps` 接近 0。
- 上游请求成功率正常，下游素材返回为空。
- 同时段有配置发布记录。

## 常见根因
- 广告位绑定的策略包被误删或版本回滚不完整。
- 过滤规则过严（地域、人群、频控）导致全部被过滤。
- 下游 provider 鉴权过期或超时阈值过小。

## 排查步骤
1. 对比发布前后配置快照，确认广告位、策略包、过滤条件变化。
2. 检查 provider 错误码分布与超时占比。
3. 抽样 20 条请求，逐跳核对过滤命中原因。
4. 临时放宽过滤阈值进行灰度验证。

## 处置建议
- 先回滚最近一次配置发布，恢复服务可用性。
- 对过滤规则增加“最小可投放集”保护。
- 为 provider 鉴权增加到期前告警。

## 回归标准
- 30 分钟内填充率恢复至历史均值的 90% 以上。
- 错误码中 `NO_ELIGIBLE_AD` 和 `PROVIDER_TIMEOUT` 占比明显回落。

## 测试问法
- “填充率突然归零但请求量正常，一般先看哪三个指标？”
- “如何判断是过滤过严还是下游 provider 故障？”
- “填充率掉零场景下的快速止损动作是什么？”
